<template>
  <li
    :class="showNewActionForm ? 'border border-gray-300' : ''"
    class="
      col-span-1
      flex flex-col
      text-center
      bg-white
      rounded-lg
      divide-y divide-gray-200
    "
  >
    <button
      v-if="!showNewActionForm"
      type="button"
      @click="showNewActionForm = true"
      class="
        relative
        block
        h-full
        w-full
        rounded-lg
        p-12
        text-center
        border-2 border-gray-300 border-dashed
        hover:border-gray-400
        focus:outline-none
        focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
      "
    >
      <svg
        class="mx-auto h-20 w-20 text-gray-400"
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        viewBox="0 0 472.6 472.6"
        aria-hidden="true"
      >
        <g>
          <path
            d="M334.7,94.5c-2.2,0-3.9,1.8-3.9,3.9v39.4c0,2.2,1.8,3.9,3.9,3.9h39.4c2.2,0,3.9-1.8,3.9-3.9V98.4c0-2.2-1.8-3.9-3.9-3.9   H334.7z M330.8,378v-11.8c0-6.5,5.3-11.8,11.8-11.8c6.5,0,11.8,5.3,11.8,11.8V378H378v-11.8c0-6.5,5.3-11.8,11.8-11.8   s11.8,5.3,11.8,11.8v23.6c0,6.5-5.3,11.8-11.8,11.8h-94.5c-6.5,0-11.8-5.3-11.8-11.8v-23.6c0-6.5,5.3-11.8,11.8-11.8   c6.5,0,11.8,5.3,11.8,11.8V378H330.8L330.8,378z M259.9,212.7h11.8c6.5,0,11.8,5.3,11.8,11.8s-5.3,11.8-11.8,11.8h-47.3   c-6.5,0-11.8-5.3-11.8-11.8s5.3-11.8,11.8-11.8h11.8V189h-35.4c-6.5,0-11.8-5.3-11.8-11.8s5.3-11.8,11.8-11.8h70.9   c6.5,0,11.8,5.3,11.8,11.8s-5.3,11.8-11.8,11.8h-11.8V212.7z M378,236.3h-11.8c-6.5,0-11.8-5.3-11.8-11.8s5.3-11.8,11.8-11.8H378   v-11.8c0-6.5,5.3-11.8,11.8-11.8s11.8,5.3,11.8,11.8v47.3c0,6.5-5.3,11.8-11.8,11.8s-11.8-5.3-11.8-11.8V236.3z M259.9,283.5h-11.8   c-6.5,0-11.8-5.3-11.8-11.8c0-6.5,5.3-11.8,11.8-11.8h23.6c6.5,0,11.8,5.3,11.8,11.8V319c0,6.5-5.3,11.8-11.8,11.8h-70.9   c-6.5,0-11.8-5.3-11.8-11.8s5.3-11.8,11.8-11.8h59.1V283.5L259.9,283.5z M334.7,70.9h39.4c15.2,0,27.6,12.3,27.6,27.6v39.4   c0,15.2-12.3,27.6-27.6,27.6h-39.4c-15.2,0-27.6-12.3-27.6-27.6V98.4C307.2,83.2,319.5,70.9,334.7,70.9z M98.4,70.9h39.4   c15.2,0,27.6,12.3,27.6,27.6v39.4c0,15.2-12.3,27.6-27.6,27.6H98.4c-15.2,0-27.6-12.3-27.6-27.6V98.4   C70.9,83.2,83.2,70.9,98.4,70.9z M98.4,94.5c-2.2,0-3.9,1.8-3.9,3.9v39.4c0,2.2,1.8,3.9,3.9,3.9h39.4c2.2,0,3.9-1.8,3.9-3.9V98.4   c0-2.2-1.8-3.9-3.9-3.9H98.4z M98.4,307.2h39.4c15.2,0,27.6,12.3,27.6,27.6v39.4c0,15.2-12.3,27.6-27.6,27.6H98.4   c-15.2,0-27.6-12.3-27.6-27.6v-39.4C70.9,319.5,83.2,307.2,98.4,307.2z M98.4,330.8c-2.2,0-3.9,1.8-3.9,3.9v39.4   c0,2.2,1.8,3.9,3.9,3.9h39.4c2.2,0,3.9-1.8,3.9-3.9v-39.4c0-2.2-1.8-3.9-3.9-3.9H98.4z M259.9,94.5h-59.1   c-6.5,0-11.8-5.3-11.8-11.8c0-6.5,5.3-11.8,11.8-11.8h70.9c6.5,0,11.8,5.3,11.8,11.8V130c0,6.5-5.3,11.8-11.8,11.8   c-6.5,0-11.8-5.3-11.8-11.8V94.5z M200.8,141.8c-6.5,0-11.8-5.3-11.8-11.8c0-6.5,5.3-11.8,11.8-11.8h23.6c6.5,0,11.8,5.3,11.8,11.8   c0,6.5-5.3,11.8-11.8,11.8H200.8z M82.7,283.5c-6.5,0-11.8-5.3-11.8-11.8c0-6.5,5.3-11.8,11.8-11.8H130c6.5,0,11.8,5.3,11.8,11.8   c0,6.5-5.3,11.8-11.8,11.8H82.7z M177.2,283.5c-6.5,0-11.8-5.3-11.8-11.8c0-6.5,5.3-11.8,11.8-11.8h23.6c6.5,0,11.8,5.3,11.8,11.8   c0,6.5-5.3,11.8-11.8,11.8H177.2z M212.7,378v11.8c0,6.5-5.3,11.8-11.8,11.8s-11.8-5.3-11.8-11.8v-23.6c0-6.5,5.3-11.8,11.8-11.8   h47.3c6.5,0,11.8,5.3,11.8,11.8c0,6.5-5.3,11.8-11.8,11.8H212.7z M165.4,212.7h11.8c6.5,0,11.8,5.3,11.8,11.8s-5.3,11.8-11.8,11.8   h-23.6c-6.5,0-11.8-5.3-11.8-11.8v-11.8H130c-6.5,0-11.8-5.3-11.8-11.8S123.4,189,130,189h23.6c6.5,0,11.8,5.3,11.8,11.8V212.7z    M70.9,200.8c0-6.5,5.3-11.8,11.8-11.8c6.5,0,11.8,5.3,11.8,11.8v23.6c0,6.5-5.3,11.8-11.8,11.8c-6.5,0-11.8-5.3-11.8-11.8V200.8z    M307.2,200.8c0-6.5,5.3-11.8,11.8-11.8s11.8,5.3,11.8,11.8v47.3c0,6.5-5.3,11.8-11.8,11.8s-11.8-5.3-11.8-11.8V200.8z    M354.4,307.2v-11.8c0-6.5,5.3-11.8,11.8-11.8h23.6c6.5,0,11.8,5.3,11.8,11.8c0,6.5-5.3,11.8-11.8,11.8H378V319   c0,6.5-5.3,11.8-11.8,11.8H319c-6.5,0-11.8-5.3-11.8-11.8v-23.6c0-6.5,5.3-11.8,11.8-11.8s11.8,5.3,11.8,11.8v11.8H354.4z    M23.6,106.3c0,6.5-5.3,11.8-11.8,11.8S0,112.9,0,106.3V59.1C0,26.4,26.4,0,59.1,0h47.3c6.5,0,11.8,5.3,11.8,11.8   s-5.3,11.8-11.8,11.8H59.1c-19.6,0-35.4,15.9-35.4,35.4V106.3z M366.2,23.6c-6.5,0-11.8-5.3-11.8-11.8S359.7,0,366.2,0h47.3   c32.6,0,59.1,26.4,59.1,59.1v47.3c0,6.5-5.3,11.8-11.8,11.8s-11.8-5.3-11.8-11.8V59.1c0-19.6-15.9-35.4-35.4-35.4H366.2z    M106.3,448.9c6.5,0,11.8,5.3,11.8,11.8s-5.3,11.8-11.8,11.8H59.1C26.4,472.6,0,446.1,0,413.5v-47.3c0-6.5,5.3-11.8,11.8-11.8   s11.8,5.3,11.8,11.8v47.3c0,19.6,15.9,35.4,35.4,35.4H106.3z M448.9,366.2c0-6.5,5.3-11.8,11.8-11.8s11.8,5.3,11.8,11.8v47.3   c0,32.6-26.4,59.1-59.1,59.1h-47.3c-6.5,0-11.8-5.3-11.8-11.8s5.3-11.8,11.8-11.8h47.3c19.6,0,35.4-15.9,35.4-35.4V366.2z"
          />
        </g>
      </svg>
      <span class="mt-4 block text-sm font-medium text-gray-900">
        Create a new QR-Codes
      </span>
    </button>
    <form
      v-else
      class="
        flex flex-col
        space-y-6
        px-6
        py-5
        w-full
        h-full
        justify-between
        text-left
      "
      @submit.prevent="addNewAction"
    >
      <div class="w-full space-y-4">
        <div>
          <label
            for="action-name"
            class="block text-sm font-medium text-gray-700"
          >
            Action Name
          </label>
          <div class="mt-1">
            <input
              id="action-name"
              name="action-name"
              type="action-name"
              required
              autofocus
              ref="actionName"
              v-model="actionName"
              class="
                appearance-none
                block
                w-full
                px-3
                py-2
                border border-gray-300
                rounded-md
                shadow-sm
                placeholder-gray-400
                focus:outline-none
                focus:ring-indigo-500
                focus:border-indigo-500
                sm:text-sm
              "
            />
          </div>
        </div>

        <div>
          <label
            for="action-value"
            class="block text-sm font-medium text-gray-700"
          >
            Action Value
          </label>
          <div class="mt-1">
            <input
              id="action-value"
              name="action-value"
              type="action-value"
              required
              ref="actionValue"
              v-model="actionValue"
              class="
                appearance-none
                block
                w-full
                px-3
                py-2
                border border-gray-300
                rounded-md
                shadow-sm
                placeholder-gray-400
                focus:outline-none
                focus:ring-indigo-500
                focus:border-indigo-500
                sm:text-sm
              "
            />
          </div>
        </div>
      </div>
      <div class="flex justify-end w-full">
        <div>
          <button
            type="button"
            @click="showNewActionForm = false"
            class="
              mt-3
              w-full
              inline-flex
              justify-center
              rounded-md
              border border-gray-300
              shadow-sm
              px-4
              py-2
              bg-white
              text-base
              font-medium
              text-gray-700
              hover:bg-gray-50
              focus:outline-none
              focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
              sm:mt-0
              sm:ml-3
              sm:w-auto
              sm:text-sm
            "
          >
            Cancel
          </button>
          <button
            type="submit"
            class="
              w-full
              inline-flex
              justify-center
              rounded-md
              border border-transparent
              shadow-sm
              px-4
              py-2
              bg-indigo-600
              text-base
              font-medium
              text-white
              hover:bg-indigo-700
              focus:outline-none
              focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
              sm:ml-3
              sm:w-auto
              sm:text-sm
            "
          >
            Save
          </button>
        </div>
      </div>
    </form>
  </li>
</template>

<script>
export default {
  props: {
    groupId: {
      type: String,
    },
  },
  data() {
    return {
      showNewActionForm: false,
      actionName: "",
      actionValue: "",
    };
  },
  methods: {
    async addNewAction() {
      const data = await this.$http.$post(
        `${this.$config.baseURL}/api/s2a/groups/${this.groupId}/action`,
        {
          actionName: this.actionName,
          actionValue: this.actionValue,
        }
      );

      if (data.error) {
        console.log(data.error);
        return;
      }

      this.$emit("newAction", this.groupId, data);

      this.actionName = "";
      this.actionValue = "";
      this.showNewActionForm = false;
    },
  },
};
</script>

<style>
</style>